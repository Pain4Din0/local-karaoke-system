<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Player</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Noto+Sans+JP:wght@400;700&family=Noto+Sans+SC:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/artplayer/5.3.0/artplayer.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://cdn.bootcdn.net/ajax/libs/remixicon/3.5.0/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="css/player.css">
</head>

<body class="bg-black text-white overflow-hidden h-screen w-screen selection:bg-white selection:text-black">
    <div id="app" class="relative w-full h-full">

        <div v-if="!hasInteracted" @click="startInteraction"
            class="absolute inset-0 z-50 bg-black flex flex-col items-center justify-center cursor-pointer">
            <div class="border border-white/20 hover:bg-white/10 transition-colors rounded-full p-6 mb-4 animate-pulse">
                <i class="ri-hand-coin-line text-4xl"></i>
            </div>
            <p class="text-xs tracking-[0.2em] text-gray-500 uppercase">{{ t('init_system') }}</p>
        </div>

        <div id="artplayer" class="w-full h-full absolute top-0 left-0 z-10"></div>

        <div v-if="!isPlayingVideo && hasInteracted"
            class="absolute inset-0 flex items-center justify-center z-20 bg-black">
            <div class="w-full max-w-5xl px-8">

                <div v-if="currentSong && currentSong.status !== 'ready'"
                    class="space-y-6 text-center max-w-2xl mx-auto">
                    <!-- Segmented Progress Bar -->
                    <div class="space-y-2">
                        <div class="w-full h-1.5 flex gap-1 opacity-80">
                            <!-- Segment 1: Video (50%) -->
                            <div class="h-full w-[50%] bg-zinc-800 rounded-l-full overflow-hidden">
                                <div class="h-full bg-blue-500 transition-all duration-300"
                                    :style="{ width: Math.min(100, Math.max(0, (currentSong.progress || 0) / 50 * 100)) + '%' }">
                                </div>
                            </div>
                            <!-- Segment 2: Audio (30%) -->
                            <div class="h-full w-[30%] bg-zinc-800 overflow-hidden">
                                <div class="h-full bg-purple-500 transition-all duration-300"
                                    :style="{ width: Math.min(100, Math.max(0, ((currentSong.progress || 0) - 50) / 30 * 100)) + '%' }">
                                </div>
                            </div>
                            <!-- Segment 3: Analysis (20%) -->
                            <div class="h-full w-[20%] bg-zinc-800 rounded-r-full overflow-hidden">
                                <div class="h-full bg-green-500 transition-all duration-300"
                                    :class="{ 'animate-fill-processing': (currentSong.progress || 0) >= 80 && (currentSong.progress || 0) < 100 }"
                                    :style="{ width: (currentSong.progress || 0) >= 100 ? '100%' : ((currentSong.progress || 0) < 80 ? '0%' : 'auto') }">
                                </div>
                            </div>
                        </div>
                        <!-- Aligned Labels -->
                        <div class="flex text-[10px] text-zinc-500 font-mono tracking-widest uppercase gap-1">
                            <span class="w-[50%]">{{ t('label_video') }}</span>
                            <span class="w-[30%]">{{ t('label_audio') }}</span>
                            <span class="w-[20%]">{{ t('label_processing') }}</span>
                        </div>
                    </div>
                    <p class="text-3xl font-light text-white truncate mt-8 opacity-80">{{ currentSong.title }}</p>
                </div>

                <div v-else class="flex flex-col md:flex-row items-center justify-center gap-12 select-none">

                    <div @click="nextNetwork" class="relative group cursor-pointer"
                        title="Click to switch network interface">
                        <div
                            class="bg-white p-4 rounded-xl shadow-2xl transition-transform group-hover:scale-105 duration-300 border-4 border-transparent group-hover:border-zinc-700">
                            <div id="qrcode" class="w-[220px] h-[220px]"></div>
                        </div>

                        <div v-if="networks.length > 1" class="absolute -bottom-10 left-0 w-full text-center">
                            <p
                                class="text-[10px] uppercase tracking-widest text-zinc-500 group-hover:text-white transition-colors bg-black/50 py-1 rounded">
                                <i class="ri-arrow-left-right-line align-middle mr-1"></i> {{ t('click_qr_switch') }}
                            </p>
                            <div class="flex justify-center gap-1.5 mt-2">
                                <div v-for="(net, idx) in networks" :key="idx"
                                    class="w-1.5 h-1.5 rounded-full transition-all"
                                    :class="idx === currentNetIndex ? 'bg-white' : 'bg-zinc-800'"></div>
                            </div>
                        </div>
                    </div>

                    <div class="text-left space-y-8 min-w-[300px]">
                        <div>
                            <p class="text-xs text-zinc-500 font-mono tracking-widest uppercase mb-2">{{
                                t('current_network') }}
                            </p>
                            <div
                                class="inline-flex items-center gap-2 border border-zinc-800 px-3 py-1 rounded-full bg-zinc-900">
                                <i class="ri-router-line text-zinc-400 text-sm"></i>
                                <span class="text-sm font-medium text-zinc-300">{{ currentNetwork.name }}</span>
                            </div>
                        </div>

                        <div>
                            <p class="text-xs text-zinc-500 font-mono tracking-widest uppercase mb-2">{{
                                t('connect_via') }}
                            </p>
                            <p class="text-4xl font-light text-white tracking-tight break-all cursor-text select-text">
                                <span class="text-zinc-600">http://</span>{{ currentNetwork.ip }}<span
                                    class="text-blue-400 font-bold">:{{ systemPort }}</span>
                            </p>
                        </div>

                        <div class="pt-4 border-t border-zinc-900">
                            <div class="flex items-center gap-2 text-zinc-500">
                                <i class="ri-wifi-line"></i>
                                <span class="text-xs uppercase tracking-wider">{{ t('host_ssid') }}: {{ systemSSID
                                    }}</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <Transition name="hud">
            <div v-if="hud.show" class="absolute top-12 left-1/2 -translate-x-1/2 z-40 pointer-events-none">
                <div
                    class="bg-black/60 backdrop-blur-md px-8 py-4 rounded-full border border-white/10 shadow-2xl flex items-center gap-4">
                    <i :class="hud.icon" class="text-3xl text-white"></i>
                    <span class="text-2xl font-medium text-white tracking-wide">{{ hud.text }}</span>
                </div>
            </div>
        </Transition>
        <Transition name="song-info">
            <div v-if="isPlayingVideo && showInfo" class="absolute top-8 left-8 max-w-2xl z-30 pointer-events-none">
                <div class="bg-black/40 backdrop-blur-md rounded-2xl p-6 border border-white/10 shadow-2xl">
                    <h1 class="text-4xl font-bold leading-tight text-white mb-3 line-clamp-2 drop-shadow-sm">{{
                        currentSong.title }}</h1>
                    <div class="flex items-center gap-3">
                        <span
                            class="bg-white/20 px-2 py-0.5 text-[10px] font-bold rounded uppercase tracking-wider text-white/90">{{
                            t('requested_by') }}</span>
                        <span class="text-lg font-light text-gray-200">{{ currentSong.requester }}</span>
                    </div>
                </div>
            </div>
        </Transition>
    </div>

    <script src="js/player.js"></script>
    
</body>

</html>